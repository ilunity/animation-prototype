<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>Animation Prototype</title>
		<style>
            * {
                padding: 0;
                margin: 0;
                border: 0;
            }

            *, *:before, *:after {
                -moz-box-sizing: border-box;
                -webkit-box-sizing: border-box;
                box-sizing: border-box;
            }

            html, body {
                height: 100%;
                width: 100%;
                font-size: 100%;
                line-height: 1;
                -ms-text-size-adjust: 100%;
                -moz-text-size-adjust: 100%;
                -webkit-text-size-adjust: 100%;
            }

            ul li {
                list-style: none;
            }

            body {
                display: flex;
                flex-direction: column;
                font-family: Arial, "Helvetica Neue", Helvetica, sans-serif;
            }

            header, footer {
                flex: 0 0 auto;
                height: 50px;
                display: flex;
                justify-content: center;
                align-items: center;
                background: #6a8fff;
            }

            header {
                margin-bottom: 30px;
            }

            main {
                flex: 1 0 auto;
                height: auto;
            }

            .some-block {
                width: 800px;
                padding: 15px;
                margin: 0 auto 30px;
                border: #6a8fff 2px dashed;
                border-radius: 10px;
            }

            .animated-list {
                width: 100%;
                height: 500px;
                margin-bottom: 30px;
                padding-right: 15px;
                cursor: default;
            }

            .animated-list_item {
                height: 100px;
                display: flex;
                justify-content: space-around;
                position: relative;
                background: white;
            }

            .animated-item_animation-wrapper {
                width: 100%;
                max-height: 100px;
                display: flex;
                justify-content: space-around;
                position: absolute;
                bottom: 0;
                overflow: hidden;

                border-top: black 1px solid;
                border-right: black 1px solid;
                background: white;

                transition: max-height 400ms ease-in-out;
            }

            .animated-item:last-child .animated-item_animation-wrapper {
                border-bottom: black 1px solid;
            }

            .animated-item_animation-wrapper__animated {
                max-height: 300px;
            }

            .animated-item_content {
                display: flex;
                column-gap: 100px;
                margin: 0 auto;
                padding: 5px 50px 30px;
            }

            .animated-item_description {
                width: 200px;
                padding: 15px;
                font-size: 12px;
            }

            .animated-item_wrapper {
                width: 900px;
            }

            .animated-item_title {
                margin-bottom: 80px;
                font-family: "Arial Narrow", serif;
                font-weight: 300;
                font-size: 125px;
            }

            .animated-item_text {
                width: 300px;
                font-size: 14px;
            }

            @media screen and (max-width: 500px) {
                .animated-item_content {
                    flex-direction: column;
                }
            }

			#mouse-deformation {
                margin: 0 auto;
                width: 700px;
                height: 400px;
			}

            canvas {
                width: 100% !important;
                height: 100% !important;
            }
		</style>
	</head>
	<body>
		<header class="header">
			Хэдер
		</header>
		<main>
			<div id="mouse-deformation"></div>
			<div class="some-block">
				Lorem ipsum dolor sit amet, consectetur adipisicing elit. Ab distinctio, eum exercitationem fugiat ipsam
				minus nemo nisi provident soluta suscipit tempora, temporibus? Animi aperiam architecto assumenda
				cupiditate deleniti doloribus, error et expedita fuga illum in inventore itaque maxime nesciunt
				obcaecati officiis optio, pariatur possimus rem repudiandae sunt velit voluptatem voluptates! Ab
				accusamus adipisci architecto aspernatur atque beatae consequatur corporis cum debitis dolor eius enim
				eos est et excepturi expedita facere facilis illo illum iste itaque labore libero magni nam nihil nobis
				eos est et excepturi expedita facere facilis illo illum iste itaque labore libero magni nam nihil nobis
				officia, perferendis provident qui quidem, quos sapiente sequi soluta suscipit unde vero voluptatibus!
				Ab dolorum ea ipsa laboriosam nemo officiis optio quam unde. Ad adipisci at cum earum maxime perferendis
				praesentium quidem rerum suscipit tempore. Architecto blanditiis cumque, ea ex harum illo impedit iusto
				nihil, numquam quam quasi quidem quo recusandae reiciendis rem sequi vel! A ad adipisci alias animi
				commodi cupiditate delectus dignissimos dolores ducimus eos error, iste laboriosam magni molestiae
				possimus recusandae rerum tempora temporibus veniam, voluptate! Asperiores aspernatur, beatae culpa
				odio odit perferendis quae quas quidem quisquam quod recusandae repudiandae, sequi totam vero, vitae
				voluptatem voluptatum? Architecto aut consectetur deserunt, dicta ducimus et eveniet exercitationem
				expedita ipsum laboriosam libero modi necessitatibus nemo nesciunt non obcaecati officiis optio possimus
				qui quia quisquam reiciendis repellat sapiente similique sit tempora veniam voluptatibus. Esse, est.
			</div>
			<ul class="animated-list">
				<li class="animated-list_item animated-item">
					<div class="animated-item_animation-wrapper">
						<div class="animated-item_content">
							<div class="animated-item_description">
								Создание емкого имени бренда @*
							</div>
							<div class="animated-item_wrapper">
								<div class="animated-item_title">NAMING</div>
								<div class="animated-item_text">
									Lorem ipsum dolor sit amet, consectetur adipisicing elit. Asperiores, autem, beatae
									debitis veritatis voluptatibus.
								</div>
							</div>
						</div>
					</div>
				</li>
				<li class="animated-list_item animated-item">
					<div class="animated-item_animation-wrapper">
						<div class="animated-item_content">
							<div class="animated-item_description">
								Создание уникального визуального языка бренда
							</div>
							<div class="animated-item_wrapper">
								<div class="animated-item_title">
									BRANDING
								</div>
								<div class="animated-item_text">
									Lorem ipsum dolor sit amet, consectetur adipisicing elit. Asperiores, autem, beatae
									debitis
									veritatis voluptatibus.
								</div>
							</div>
						</div>
					</div>
				</li>
				<li class="animated-list_item animated-item">
					<div class="animated-item_animation-wrapper">
						<div class="animated-item_content">
							<div class="animated-item_description">
								Продюсирование и создание visual-контента
							</div>
							<div class="animated-item_wrapper">
								<div class="animated-item_title">PRODUCTION</div>
								<div class="animated-item_text">
									Lorem ipsum dolor sit amet, consectetur adipisicing elit. Asperiores, autem, beatae
									debitis
									veritatis voluptatibus.
								</div>
							</div>
						</div>
					</div>
				</li>
				<li class="animated-list_item animated-item">
					<div class="animated-item_animation-wrapper">
						<div class="animated-item_content">
							<div class="animated-item_description">
								Коммуникационная стратегия. План завоевания брендом его аудитории
							</div>
							<div class="animated-item_wrapper">
								<div class="animated-item_title">
									STRATEGY
								</div>
								<div class="animated-item_text">
									Lorem ipsum dolor sit amet, consectetur adipisicing elit. Asperiores, autem, beatae
									debitis
									veritatis voluptatibus.
								</div>
							</div>
						</div>
					</div>
				</li>
				<li class="animated-list_item animated-item">
					<div class="animated-item_animation-wrapper">
						<div class="animated-item_content">
							<div class="animated-item_description">
								Нестрандартное решение коммуникационной задачи бренда.
							</div>
							<div class="animated-item_wrapper">
								<div class="animated-item_title">
									CREATIVE
								</div>
								<div class="animated-item_text">
									Lorem ipsum dolor sit amet, consectetur adipisicing elit. Asperiores, autem, beatae
									debitis
									veritatis voluptatibus.
								</div>
							</div>
						</div>
					</div>
				</li>
			</ul>
			<div class="some-block">
				Lorem ipsum dolor sit amet, consectetur adipisicing elit. Ab distinctio, eum exercitationem fugiat ipsam
				minus nemo nisi provident soluta suscipit tempora, temporibus? Animi aperiam architecto assumenda
				cupiditate deleniti doloribus, error et expedita fuga illum in inventore itaque maxime nesciunt
				obcaecati officiis optio, pariatur possimus rem repudiandae sunt velit voluptatem voluptates! Ab
				accusamus adipisci architecto aspernatur atque beatae consequatur corporis cum debitis dolor eius enim
				eos est et excepturi expedita facere facilis illo illum iste itaque labore libero magni nam nihil nobis
				eos est et excepturi expedita facere facilis illo illum iste itaque labore libero magni nam nihil nobis
				officia, perferendis provident qui quidem, quos sapiente sequi soluta suscipit unde vero voluptatibus!
				Ab dolorum ea ipsa laboriosam nemo officiis optio quam unde. Ad adipisci at cum earum maxime perferendis
				praesentium quidem rerum suscipit tempore. Architecto blanditiis cumque, ea ex harum illo impedit iusto
				nihil, numquam quam quasi quidem quo recusandae reiciendis rem sequi vel! A ad adipisci alias animi
				commodi cupiditate delectus dignissimos dolores ducimus eos error, iste laboriosam magni molestiae
				possimus recusandae rerum tempora temporibus veniam, voluptate! Asperiores aspernatur, beatae culpa
				odio odit perferendis quae quas quidem quisquam quod recusandae repudiandae, sequi totam vero, vitae
				voluptatem voluptatum? Architecto aut consectetur deserunt, dicta ducimus et eveniet exercitationem
				expedita ipsum laboriosam libero modi necessitatibus nemo nesciunt non obcaecati officiis optio possimus
				qui quia quisquam reiciendis repellat sapiente similique sit tempora veniam voluptatibus. Esse, est.
			</div>
		</main>
		<footer class="footer">
			Футер
		</footer>
		<script>
          const animatedBlocks = document.querySelectorAll('.animated-item_animation-wrapper');

          const animatedClassName = 'animated-item_animation-wrapper__animated';
          let animatedBlocksStatuses = [];
          for (let i = 0; i < animatedBlocks.length; i++) {
            animatedBlocksStatuses.push({
              mouse: false,
              animation: false,
            });

            animatedBlocks[i].addEventListener('mouseenter', () => {
              animatedBlocksStatuses[i].mouse = true;
              animatedBlocksStatuses[i].animation = true;
              animatedBlocks[i].classList.add(animatedClassName);

              setTimeout(() => {
                animatedBlocksStatuses[i].animation = false;
                if (animatedBlocksStatuses[i].mouse) {
                  return;
                }

                animatedBlocks[i].classList.remove(animatedClassName);
              }, 400);
            });

            animatedBlocks[i].addEventListener('mouseleave', () => {
              animatedBlocksStatuses[i].mouse = false;

              if (animatedBlocksStatuses[i].animation) {
                return;
              }

              animatedBlocks[i].classList.remove(animatedClassName);
            });
          }
		</script>
		<script src='https://cdn.jsdelivr.net/npm/ogl@0.0.64/dist/ogl.umd.js'></script>
		<script type="module">
          const imgSize = [ 100, 100 ];

          const vertex = `
					attribute vec2 uv;
					attribute vec2 position;
					varying vec2 vUv;
					void main() {
							vUv = uv;
							gl_Position = vec4(position, 0, 1);
					}
			`;
          const fragment = `
					precision highp float;
					precision highp int;
					uniform sampler2D tWater;
					uniform sampler2D tFlow;
					uniform float uTime;
					varying vec2 vUv;
					uniform vec4 res;

					void main() {

							// R and G values are velocity in the x and y direction
							// B value is the velocity length
							vec3 flow = texture2D(tFlow, vUv).rgb;

							vec2 uv = .5 * gl_FragCoord.xy / res.xy ;
							vec2 myUV = (uv - vec2(0.5))*res.zw + vec2(0.5);
							myUV -= flow.xy * (0.15 * 0.7);

							vec2 myUV2 = (uv - vec2(0.5))*res.zw + vec2(0.5);
							myUV2 -= flow.xy * (0.125 * 0.7);

							vec2 myUV3 = (uv - vec2(0.5))*res.zw + vec2(0.5);
							myUV3 -= flow.xy * (0.10 * 0.7);

							vec3 tex = texture2D(tWater, myUV).rgb;
							vec3 tex2 = texture2D(tWater, myUV2).rgb;
							vec3 tex3 = texture2D(tWater, myUV3).rgb;

              gl_FragColor = vec4(tex.r, tex2.g, tex3.b, 1.0);
					}
			`;
          {
            const renderer = new ogl.Renderer({ dpr: 2 });
            const gl = renderer.gl;
            // $(gl.canvas).appendTo('#mouse-deformation');
            const wrapper = document.querySelector('#mouse-deformation');
            wrapper.appendChild(gl.canvas);

            // Variable inputs to control flowmap
            let aspect = 1;
            const mouse = new ogl.Vec2(-1);
            const velocity = new ogl.Vec2();

            function resize() {
              let a1, a2;
              var imageAspect = imgSize[1] / imgSize[0];
              if (window.innerHeight / window.innerWidth < imageAspect) {
                a1 = 1;
                a2 = window.innerHeight / window.innerWidth / imageAspect;
              } else {
                a1 = (window.innerWidth / window.innerHeight) * imageAspect;
                a2 = 1;
              }
              mesh.program.uniforms.res.value = new ogl.Vec4(
                window.innerWidth,
                window.innerHeight,
                a1,
                a2,
              );

              renderer.setSize(window.innerWidth, window.innerHeight);
              aspect = window.innerWidth / window.innerHeight;
            }

            const flowmap = new ogl.Flowmap(gl, {
              falloff: 1.0, // size of the stamp, percentage of the size
              alpha: 0.3, // opacity of the stamp
              dissipation: 0.94, // affects the speed that the stamp fades. Closer to 1 is slower
            });
            // Triangle that includes -1 to 1 range for 'position', and 0 to 1 range for 'uv'.
            const geometry = new ogl.Geometry(gl, {
              position: {
                size: 2,
                data: new Float32Array([ -1, -1, 3, -1, -1, 3 ]),
              },
              uv: { size: 2, data: new Float32Array([ 0, 0, 2, 0, 0, 2 ]) },
            });
            const texture = new ogl.Texture(gl, {
              minFilter: gl.LINEAR,
              magFilter: gl.LINEAR,
            });
            const img = new Image();
            img.onload = () => (texture.image = img);
            img.crossOrigin = 'Anonymous';
            img.src = 'http://localhost:63342/animation/img.png';

            let a1, a2;
            var imageAspect = imgSize[1] / imgSize[0];
            if (window.innerHeight / window.innerWidth < imageAspect) {
              a1 = 1;
              a2 = window.innerHeight / window.innerWidth / imageAspect;
            } else {
              a1 = (window.innerWidth / window.innerHeight) * imageAspect;
              a2 = 1;
            }

            const program = new ogl.Program(gl, {
              vertex,
              fragment,
              uniforms: {
                uTime: { value: 0 },
                tWater: { value: texture },
                res: {
                  value: new ogl.Vec4(window.innerWidth, window.innerHeight, a1, a2),
                },
                img: { value: new ogl.Vec2(imgSize[0], imgSize[1]) },
                // Note that the uniform is applied without using an object and value property
                // This is because the class alternates this texture between two render targets
                // and updates the value property after each render.
                tFlow: flowmap.uniform,
              },
            });
            const mesh = new ogl.Mesh(gl, { geometry, program });

            window.addEventListener('resize', resize, false);
            resize();

            // Create handlers to get mouse position and velocity
            const isTouchCapable = 'ontouchstart' in window;
            if (isTouchCapable) {
              window.addEventListener('touchstart', updateMouse, false);
              window.addEventListener('touchmove', updateMouse, { passive: false });
            } else {
              window.addEventListener('mousemove', updateMouse, false);
            }
            let lastTime;
            const lastMouse = new ogl.Vec2();

            function updateMouse( e ) {
              e.preventDefault();
              if (e.changedTouches && e.changedTouches.length) {
                e.x = e.changedTouches[0].pageX;
                e.y = e.changedTouches[0].pageY;
              }
              if (e.x === undefined) {
                e.x = e.pageX;
                e.y = e.pageY;
              }
              // Get mouse value in 0 to 1 range, with y flipped
              mouse.set(e.x / gl.renderer.width, 1.0 - e.y / gl.renderer.height);
              // Calculate velocity
              if (!lastTime) {
                // First frame
                lastTime = performance.now();
                lastMouse.set(e.x, e.y);
              }

              const deltaX = e.x - lastMouse.x;
              const deltaY = e.y - lastMouse.y;

              lastMouse.set(e.x, e.y);

              let time = performance.now();

              // Avoid dividing by 0
              let delta = Math.max(10.4, time - lastTime);
              lastTime = time;
              velocity.x = deltaX / delta;
              velocity.y = deltaY / delta;
              // Flag update to prevent hanging velocity values when not moving
              velocity.needsUpdate = true;
            }

            requestAnimationFrame(update);

            function update( t ) {
              requestAnimationFrame(update);
              // Reset velocity when mouse not moving
              if (!velocity.needsUpdate) {
                mouse.set(-1);
                velocity.set(0);
              }
              velocity.needsUpdate = false;
              // Update flowmap inputs
              flowmap.aspect = aspect;
              flowmap.mouse.copy(mouse);
              // Ease velocity input, slower when fading out
              flowmap.velocity.lerp(velocity, velocity.len ? 0.15 : 0.1);
              flowmap.update();
              program.uniforms.uTime.value = t * 0.01;
              renderer.render({ scene: mesh });
            }
          }
		</script>
	</body>
</html>
